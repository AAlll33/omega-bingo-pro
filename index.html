<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OMEGA Bingo - P√°gina Oficial</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet" />
  
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f9fafb;
    }

    /* --- ANIMACI√ìN DE FONDO (BOLAS FLOTANTES) --- */
    .hero-section {
        background: linear-gradient(135deg, #2e004f 0%, #6b00b6 100%); /* Gradiente Morado */
        position: relative;
        overflow: hidden;
    }

    .floating-shape {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        animation: floatAnimation 10s infinite ease-in-out;
        z-index: 1; /* Detr√°s del contenido */
    }

    /* Tama√±os y posiciones variadas para las bolas */
    .shape-1 { width: 100px; height: 100px; top: 10%; left: 5%; animation-duration: 12s; }
    .shape-2 { width: 150px; height: 150px; bottom: 20%; right: 10%; animation-duration: 15s; }
    .shape-3 { width: 60px; height: 60px; top: 40%; left: 80%; animation-duration: 8s; }
    .shape-4 { width: 200px; height: 200px; top: -50px; right: 30%; animation-duration: 20s; opacity: 0.05; }
    .shape-5 { width: 80px; height: 80px; bottom: 5%; left: 20%; animation-duration: 10s; background: rgba(255, 215, 0, 0.15); /* Bola dorada tenue */ }

    @keyframes floatAnimation {
        0% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-30px) rotate(20deg); }
        100% { transform: translateY(0) rotate(0deg); }
    }

    /* Ajustes Swiper */
    .swiper-ticker .swiper-wrapper {
      transition-timing-function: linear;
    }
    
    .hover-scale:hover {
      transform: scale(1.05);
      transition: transform 0.3s;
    }

    /* Estilo para los puntos de paginaci√≥n del banner principal */
    .hero-pagination .swiper-pagination-bullet {
        background: white;
        opacity: 0.5;
        width: 10px;
        height: 10px;
    }
    .hero-pagination .swiper-pagination-bullet-active {
        background: #fbbf24; /* Color amarillo/dorado */
        opacity: 1;
        width: 25px;
        border-radius: 5px;
        transition: width 0.3s;
    }
  </style>
</head>
<body class="text-gray-800">

  <header class="bg-purple-900 text-white p-4 flex justify-between items-center sticky top-0 z-50 shadow-lg">
    <h1 class="text-2xl md:text-3xl font-extrabold uppercase tracking-widest">OMEGA Bingo</h1>
    <div class="flex gap-2 md:gap-4">
      <a href="https://omegabingo.pages.dev/" class="bg-green-500 hover:bg-green-600 px-3 py-2 rounded font-bold uppercase shadow-lg text-sm md:text-base transition">Comprar</a>
      <button onclick="scrollToSeccion('juegos')" class="bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded font-bold uppercase shadow-lg text-sm md:text-base transition">Juegos</button>
    </div>
  </header>

  <section class="bg-[#1e0030] py-3 border-b-4 border-yellow-500 overflow-hidden relative z-20">
    <div class="swiper swiper-ticker w-full">
      <div class="swiper-wrapper">
        <div class="swiper-slide w-auto px-6">
            <a href="#" class="flex items-center gap-3 group text-decoration-none cursor-pointer">
                <img src="https://randomuser.me/api/portraits/women/44.jpg" class="w-12 h-12 rounded-full border-2 border-yellow-400" alt="Ganador">
                <div class="text-left leading-tight">
                    <p class="text-white font-bold text-sm">Maria L.</p>
                    <p class="text-yellow-400 text-xs font-bold uppercase">Bingo 75</p>
                    <p class="text-white font-black text-sm">Gan√≥ $120</p>
                </div>
            </a>
        </div>
        <div class="swiper-slide w-auto px-6">
            <a href="#" class="flex items-center gap-3 group text-decoration-none cursor-pointer">
                <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-12 h-12 rounded-full border-2 border-yellow-400" alt="Ganador">
                <div class="text-left leading-tight">
                    <p class="text-white font-bold text-sm">Carlos R.</p>
                    <p class="text-yellow-400 text-xs font-bold uppercase">Ruleta</p>
                    <p class="text-white font-black text-sm">Gan√≥ $500</p>
                </div>
            </a>
        </div>
        <div class="swiper-slide w-auto px-6">
            <a href="#" class="flex items-center gap-3 group text-decoration-none cursor-pointer">
                <img src="https://randomuser.me/api/portraits/women/65.jpg" class="w-12 h-12 rounded-full border-2 border-yellow-400" alt="Ganador">
                <div class="text-left leading-tight">
                    <p class="text-white font-bold text-sm">Ana P.</p>
                    <p class="text-yellow-400 text-xs font-bold uppercase">Tragamonedas</p>
                    <p class="text-white font-black text-sm">Gan√≥ $1.200</p>
                </div>
            </a>
        </div>
      </div>
    </div>
  </section>

  <section class="hero-section py-8 md:py-12 relative" id="inicio">
    
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
    <div class="floating-shape shape-4"></div>
    <div class="floating-shape shape-5"></div>

    <div class="container mx-auto px-4 relative z-10">
        
        <div class="text-center mb-6">
            <h2 class="text-3xl md:text-5xl font-extrabold text-white drop-shadow-lg">
                ¬°Bienvenido a <span class="text-yellow-400">OMEGA Bingo</span>!
            </h2>
            <p class="text-purple-200 mt-2 text-lg">Los mejores juegos y premios te esperan</p>
        </div>

        <div class="swiper hero-swiper w-full rounded-2xl shadow-2xl overflow-hidden border-4 border-white/20">
            <div class="swiper-wrapper">
                
                <div class="swiper-slide relative">
                    <a href="#reservas" class="block w-full h-full relative">
                        <img src="https://via.placeholder.com/1200x500/4a1d96/ffffff?text=BONO+DE+BIENVENIDA+100%25" 
                             class="w-full h-64 md:h-96 object-cover" alt="Promo 1">
                        
                        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2">
                            <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg uppercase text-lg transition hover:scale-105 animate-bounce">
                                ¬°Jugar Ahora!
                            </button>
                        </div>
                    </a>
                </div>

                <div class="swiper-slide">
                    <a href="#juegos" class="block w-full h-full">
                        <img src="https://via.placeholder.com/1200x500/c026d3/ffffff?text=GRAN+SORTEO+NAVIDE√ëO" 
                             class="w-full h-64 md:h-96 object-cover" alt="Promo 2">
                    </a>
                </div>

                <div class="swiper-slide">
                    <a href="https://wa.me/tu-numero" target="_blank" class="block w-full h-full">
                        <img src="https://via.placeholder.com/1200x500/2563eb/ffffff?text=√öNETE+AL+GRUPO+VIP" 
                             class="w-full h-64 md:h-96 object-cover" alt="Promo 3">
                    </a>
                </div>

            </div>
            
            <div class="swiper-pagination hero-pagination"></div>
            <div class="swiper-button-next text-white/70 hover:text-white"></div>
            <div class="swiper-button-prev text-white/70 hover:text-white"></div>
        </div>

    </div>
  </section>
  <section class="py-12 px-4 bg-white" id="juegos">
    <h3 class="text-3xl font-extrabold text-center mb-8 text-purple-900">Nuestras Salas</h3>
    
    <div class="swiper mySwiperGroups max-w-6xl mx-auto px-4 pb-12">
      <div class="swiper-wrapper">
        <div class="swiper-slide bg-gray-100 rounded-lg shadow-lg p-4 hover-scale border border-gray-200">
          <img src="grupoa.jpeg" onerror="this.src='https://via.placeholder.com/300x200?text=Grupo+A'" class="w-full h-48 object-cover rounded mb-4" alt="Grupo A" />
          <h4 class="text-xl font-bold mb-2 text-purple-900">Grupo A - Tarde</h4>
          <p class="mb-4 text-sm text-gray-600">√önete a nuestro grupo para participar en los sorteos de la tarde.</p>
          <a href="https://chat.whatsapp.com/CIL8NiFHcbvAQwEw9Xwfiq" target="_blank" class="block bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded text-center font-bold shadow transition">Entrar en WhatsApp</a>
        </div>

        <div class="swiper-slide bg-gray-100 rounded-lg shadow-lg p-4 hover-scale border border-gray-200">
          <img src="https://via.placeholder.com/300x200.png?text=Grupo+B" class="w-full h-48 object-cover rounded mb-4" alt="Grupo B" />
          <h4 class="text-xl font-bold mb-2 text-purple-900">Grupo B - Noche</h4>
          <p class="mb-4 text-sm text-gray-600">Participa en sorteos nocturnos y promociones exclusivas.</p>
          <a href="#" target="_blank" class="block bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded text-center font-bold shadow transition">Entrar en WhatsApp</a>
        </div>

        <div class="swiper-slide bg-gray-100 rounded-lg shadow-lg p-4 hover-scale border border-gray-200">
            <img src="https://via.placeholder.com/300x200.png?text=Grupo+C" class="w-full h-48 object-cover rounded mb-4" alt="Grupo C" />
            <h4 class="text-xl font-bold mb-2 text-purple-900">Grupo C - VIP</h4>
            <p class="mb-4 text-sm text-gray-600">Mesas de alto valor y premios r√°pidos.</p>
            <a href="#" target="_blank" class="block bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded text-center font-bold shadow transition">Entrar en WhatsApp</a>
          </div>
      </div>
      
      <div class="swiper-button-next text-purple-900"></div>
      <div class="swiper-button-prev text-purple-900"></div>
      <div class="swiper-pagination"></div>
    </div>
  </section>

  <section class="py-12 bg-purple-50 px-4" id="ganadores">
    <h3 class="text-3xl font-extrabold text-center mb-8 text-purple-900">√öltimos Ganadores</h3>
    <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-4">
      <div class="bg-white p-6 rounded-lg shadow-md cursor-pointer hover:shadow-xl transition flex items-center gap-4 border-l-4 border-green-500" onclick="mostrarGanador('Juan P√©rez', 'https://via.placeholder.com/400x300?text=Comprobante', '¬°Incre√≠ble, pagaron al instante!')">
        <div class="bg-green-100 p-4 rounded-full text-green-600 text-2xl font-bold">JP</div>
        <div>
            <p class="font-bold text-lg text-gray-800">Juan P√©rez</p>
            <p class="text-gray-500 text-sm italic">"Particip√© en el √∫ltimo sorteo y gan√© Bs. 500."</p>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-lg shadow-md cursor-pointer hover:shadow-xl transition flex items-center gap-4 border-l-4 border-blue-500">
        <div class="bg-blue-100 p-4 rounded-full text-blue-600 text-2xl font-bold">MR</div>
        <div>
            <p class="font-bold text-lg text-gray-800">Mar√≠a Rodriguez</p>
            <p class="text-gray-500 text-sm italic">"La atenci√≥n es muy r√°pida y segura."</p>
        </div>
      </div>
    </div>
  </section>

  <div id="modalGanador" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4 backdrop-blur-sm">
    <div class="bg-white p-6 rounded-2xl max-w-md w-full relative shadow-2xl animate-[fadeIn_0.3s_ease-out]">
      <button class="absolute top-3 right-3 text-gray-400 hover:text-red-500 text-2xl font-bold transition" onclick="cerrarGanador()">&times;</button>
      <h4 class="text-2xl font-bold mb-4 text-center text-purple-900" id="nombreGanador"></h4>
      <div class="flex justify-center mb-4 bg-gray-100 rounded-lg p-2">
          <img src="" alt="Capture" class="max-h-64 object-contain" id="imagenGanador" />
      </div>
      <p class="text-center text-gray-700 italic border-t pt-4" id="comentarioGanador"></p>
    </div>
  </div>

  <footer class="bg-purple-900 text-white py-10 px-4 text-center mt-auto border-t-4 border-yellow-500">
            <div class="mt-12 text-center">
                <img src="logo-omega-bingo.png" id="footer-logo" class="mx-auto w-24 rounded-full shadow-lg bg-white p-1" alt="Logo">
                <h3 class="text-xl font-bold text-white mb-4">S√≠guenos en Redes Sociales</h3>
                <div class="flex justify-center space-x-6 mb-6">
                    <a href="https://wa.me/584226431972" target="_blank" class="text-white hover:text-green-400 transition-colors" title="WhatsApp">
                        <i class="fab fa-whatsapp fa-3x" style="color:#25D366;"></i>
                    </a>
                    <a href="https://www.facebook.com/OmegabingoAA/" target="_blank" class="text-white hover:text-blue-600 transition-colors" title="Facebook">
                        <i class="fab fa-facebook fa-3x"></i>
                    </a>
                    <a href="https://www.instagram.com/omega_bingo?igsh=MTY4czZ0NDltZ2gxZA==" target="_blank" class="text-white hover:text-pink-600 transition-colors" title="Instagram">
                        <i class="fab fa-instagram fa-3x"></i>
                    </a>
                </div>

                <div class="flex justify-center space-x-4 mb-6 text-sm">
                    <button onclick="showLegalModal('terms')" class="text-yellow-300 font-bold hover:underline">T√©rminos y Condiciones</button>
                    <span class="text-purple-300">|</span>
                    <button onclick="showLegalModal('privacy')" class="text-yellow-300 font-bold hover:underline">Pol√≠tica de Privacidad</button>
                </div>

                <p class="text-xs text-purple-200 mt-4">¬© OMEGA Bingo / Masson 2025. Todos los derechos reservados</p>
                <img src="logo-masson-bingo.png" id="footer-logo-masson" class="h-auto w-16 inline-block" alt="logo">
            </div>
  </footer>

  <script>
    // 1. Ticker de ganadores (Barra superior)
    const swiperTicker = new Swiper('.swiper-ticker', {
      slidesPerView: 'auto',
      spaceBetween: 0,
      loop: true,
      speed: 4000,
      autoplay: {
        delay: 0,
        disableOnInteraction: false,
      },
      allowTouchMove: true,
    });

    // 2. NUEVO: Slider Hero (Banner Grande)
    const heroSwiper = new Swiper('.hero-swiper', {
        slidesPerView: 1,
        loop: true,
        effect: 'fade', // Efecto de desvanecimiento elegante
        fadeEffect: { crossFade: true },
        autoplay: {
            delay: 5000, // Cambia cada 5 segundos
            disableOnInteraction: false,
        },
        pagination: {
            el: ".hero-pagination",
            clickable: true,
        },
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
    });

    // 3. Slider de Grupos
    const swiperGroups = new Swiper('.mySwiperGroups', {
      slidesPerView: 1,
      spaceBetween: 20,
      loop: true,
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      breakpoints: {
        640: { slidesPerView: 2 },
        1024: { slidesPerView: 3 },
      }
    });

    // Funci√≥n scroll suave
    function scrollToSeccion(id) {
      const element = document.getElementById(id);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth' });
      }
    }

    // Modal
    function mostrarGanador(nombre, imagenUrl, comentario) {
      document.getElementById('nombreGanador').innerText = nombre;
      document.getElementById('imagenGanador').src = imagenUrl;
      document.getElementById('comentarioGanador').innerText = comentario;
      const modal = document.getElementById('modalGanador');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function cerrarGanador() {
      const modal = document.getElementById('modalGanador');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }

    // ==========================================================
        // ============== CONFIGURACI√ìN BINGO ==============
        // ==========================================================
        const TOTAL_CARDS = 75;
        const CARD_PRICE = 300;
        const BINGO_DATE_STRING = 'December 8, 2025 19:00:00'; 
        const BINGO_DATE = new Date(BINGO_DATE_STRING).getTime(); 
        
        let selectedCards = JSON.parse(localStorage.getItem('omega_selected_cards')) || [];
        let liveData = {};
        let previewCard = null;
        let timerInterval;
        let adminClicks = 0;
        let isStoreOpen = true; 

        // ==========================================================
        // ============== üïπÔ∏è L√ìGICA DEL JUEGO DINO (VERSI√ìN TURBO) üïπÔ∏è ==============
        // ==========================================================
        
        const canvas = document.getElementById('dinoCanvas');
        const ctx = canvas.getContext('2d');
        let gameAnimationFrame;
        let gameScore = 0;
        
        // üöÄ AJUSTE DE VELOCIDAD AQU√ç
        let gameSpeed = 5; // EMPIEZA MUCHO M√ÅS R√ÅPIDO (Antes era 5)
        
        let isGaming = false;
        
        // Ajustar canvas
        canvas.width = 600;
        canvas.height = 200;

        // Entidades (GRAVEDAD M√ÅS FUERTE PARA SALTO R√ÅPIDO)
        let dino = { x: 50, y: 150, width: 30, height: 30, dy: 0, jumpPower: -15, gravity: 0.8, grounded: true };
        let obstacles = [];
        let frameCount = 0;

        // Dibujar Pixel Art Simple
        function drawPixelDino(x, y) {
            ctx.fillStyle = 'black';
            // Cuerpo
            ctx.fillRect(x, y, 30, 30);
            // Cabeza
            ctx.fillRect(x + 10, y - 10, 20, 20);
            // Ojo
            ctx.fillStyle = 'white';
            ctx.fillRect(x + 20, y - 5, 5, 5);
        }

        function drawCactus(x, y, w, h) {
            ctx.fillStyle = '#9333ea'; // Morado Omega
            ctx.fillRect(x, y, w, h);
            // Detalle
            ctx.fillStyle = '#7e22ce';
            ctx.fillRect(x+5, y+5, w-10, h-10);
        }

        function drawBird(x, y) {
            ctx.fillStyle = '#4b5563'; // Gris oscuro
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x+15, y+10);
            ctx.lineTo(x+30, y);
            ctx.lineTo(x+15, y-5);
            ctx.fill();
        }

        function spawnObstacle() {
            let type = Math.random() > 0.7 ? 'bird' : 'cactus';
            let obj = { x: canvas.width, type: type, passed: false };

            if(type === 'cactus') {
                obj.y = 150; 
                obj.width = 20 + Math.random() * 20;
                obj.height = 30 + Math.random() * 20; 
            } else {
                obj.y = 90 + Math.random() * 40; // Altura variable
                obj.width = 30;
                obj.height = 20;
            }
            obstacles.push(obj);
        }

        function updateGame() {
            if(!isGaming) return;

            // Limpiar
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Fondo Suelo
            ctx.beginPath();
            ctx.moveTo(0, 180);
            ctx.lineTo(canvas.width, 180);
            ctx.strokeStyle = '#ddd';
            ctx.stroke();

            // F√≠sica Dino
            dino.dy += dino.gravity;
            dino.y += dino.dy;

            // Colisi√≥n suelo
            if (dino.y > 150) {
                dino.y = 150;
                dino.dy = 0;
                dino.grounded = true;
            } else {
                dino.grounded = false;
            }

            drawPixelDino(dino.x, dino.y);

            // Obst√°culos
            frameCount++;
            if (frameCount % (100 - Math.floor(gameSpeed * 2)) === 0) {
                spawnObstacle();
            }

            for (let i = 0; i < obstacles.length; i++) {
                let obs = obstacles[i];
                obs.x -= gameSpeed;

                if (obs.type === 'cactus') drawCactus(obs.x, obs.y, obs.width, obs.height);
                else drawBird(obs.x, obs.y);

                // Colisi√≥n
                if (
                    dino.x < obs.x + obs.width &&
                    dino.x + dino.width > obs.x &&
                    dino.y < obs.y + obs.height &&
                    dino.y + dino.height > obs.y
                ) {
                    gameOver();
                }

                // Puntaje
                if (obs.x + obs.width < dino.x && !obs.passed) {
                    gameScore += 10;
                    obs.passed = true;
                    document.getElementById('gameScore').innerText = gameScore;
                    
                    // üöÄ ACELERACI√ìN AGRESIVA
                    if(gameScore % 100 === 0) {
                        gameSpeed += 0.5; // Aumenta m√°s r√°pido
                    }
                }
            }
            
            // Limpiar obst√°culos viejos
            obstacles = obstacles.filter(obs => obs.x > -50);

            gameAnimationFrame = requestAnimationFrame(updateGame);
        }

        function jumpDino() {
            if (!isGaming) return;
            if (dino.grounded) {
                dino.dy = dino.jumpPower;
                dino.grounded = false;
            }
        }

        // Controles Teclado
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space' && isGaming) {
                jumpDino();
            }
        });

        function startGame() {
            document.getElementById('gameMessage').classList.add('hidden');
            gameScore = 0;
            // VELOCIDAD DE REINICIO
            gameSpeed = 5; 
            obstacles = [];
            dino.y = 150;
            dino.dy = 0;
            isGaming = true;
            document.getElementById('gameScore').innerText = "0";
            updateGame();
        }

        function gameOver() {
            isGaming = false;
            cancelAnimationFrame(gameAnimationFrame);
            document.getElementById('msgTitle').innerText = "GAME OVER";
            document.getElementById('msgTitle').classList.add('text-red-600');
            document.querySelector('#gameMessage button').innerText = "INTENTAR DE NUEVO ‚Ü∫";
            document.getElementById('gameMessage').classList.remove('hidden');
        }

        function stopGameLogic() {
            isGaming = false;
            cancelAnimationFrame(gameAnimationFrame);
        }

        // ================== INICIALIZACI√ìN GENERAL ==================
        window.onload = () => {
            document.getElementById('bingoDateDisplay').textContent = new Date(BINGO_DATE).toLocaleDateString('es-ES', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' 
            });

            startRealtimeSync();
            startBingoTimer();
            checkStoreStatus(); 
            
            const pendingTimer = localStorage.getItem('omega_payment_start');
            if (pendingTimer && selectedCards.length > 0) {
                 startPaymentTimer(); 
            }

            document.getElementById('payFile').addEventListener('change', function(e) {
                if(this.files[0]) document.getElementById('fileNameDisplay').textContent = this.files[0].name;
            });
        };

        function saveLocalSelection() {
            localStorage.setItem('omega_selected_cards', JSON.stringify(selectedCards));
        }

        // ----------------------------------------------------
        // =========== L√ìGICA DE TIENDA + JUEGO INTEGRADO ==========
        // ----------------------------------------------------
        
        function checkStoreStatus() {
            db.collection('config').doc('general').onSnapshot(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    isStoreOpen = data.isStoreOpen;
                } else {
                    db.collection('config').doc('general').set({ isStoreOpen: true });
                    isStoreOpen = true;
                }
                updateStoreUI();
            });
        }

        function updateStoreUI() {
            const overlay = document.getElementById('closedStoreOverlay');
            const currentUser = auth.currentUser;
            const btn = document.getElementById('toggleStoreBtn');
            const statusText = document.getElementById('storeStatusText');

            if(btn) {
                if(isStoreOpen) {
                    btn.textContent = "CERRAR TIENDA üîí";
                    btn.className = "px-6 py-3 rounded-lg font-black text-white transition-colors shadow-lg bg-red-600 hover:bg-red-700";
                    statusText.textContent = "La tienda est√° ABIERTA al p√∫blico.";
                    statusText.className = "text-sm text-green-600 font-bold";
                } else {
                    btn.textContent = "ABRIR TIENDA üîì";
                    btn.className = "px-6 py-3 rounded-lg font-black text-white transition-colors shadow-lg bg-green-600 hover:bg-green-700";
                    statusText.textContent = "La tienda est√° CERRADA al p√∫blico.";
                    statusText.className = "text-sm text-red-600 font-bold";
                }
            }

            if (!isStoreOpen && !currentUser) {
                overlay.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                // üõë NO iniciamos el juego autom√°ticamente para no consumir bater√≠a hasta que den click en JUGAR
            } else {
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto';
                stopGameLogic(); // Detener juego si se abre la tienda
            }
        }

        function toggleStoreStatus() {
            const newState = !isStoreOpen;
            if(confirm(newState ? "¬øABRIR la tienda al p√∫blico?" : "¬øCERRAR la tienda? Nadie podr√° comprar.")) {
                db.collection('config').doc('general').set({ isStoreOpen: newState }, { merge: true })
                .catch(err => alert("Error al cambiar estado: " + err.message));
            }
        }

        // Trigger Secreto Admin en Overlay (Candado)
        let lockClicks = 0;
        document.getElementById('adminSecretLock').addEventListener('click', () => {
            lockClicks++;
            if(lockClicks >= 6) {
                document.getElementById('closedStoreOverlay').style.display = 'none'; 
                stopGameLogic();
                document.getElementById('clientContent').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('adminLogin').classList.remove('hidden');
                lockClicks = 0;
            }
        });


        // ----------------------------------------------------
        // =========== SINCRONIZACI√ìN Y LIVE DATA ==========
        // ----------------------------------------------------

        function startRealtimeSync() {
            db.collection('ventasConfirmadas').onSnapshot(snap => {
                snap.docChanges().forEach(change => {
                    const d = change.doc.data();
                    (d.cards || []).forEach(c => {
                        if(change.type === 'removed') delete liveData[c];
                        else liveData[c] = { status: 'sold', ...d };
                    });
                });
                updateUI();
                if(auth.currentUser) renderAdminSoldList();
            });

            db.collection('reservasPendientes').onSnapshot(snap => {
                snap.docChanges().forEach(change => {
                    const d = change.doc.data();
                    const docId = change.doc.id; 
                    
                    (d.cards || []).forEach(c => {
                        const isSold = liveData[c]?.status === 'sold';
                        if(change.type === 'removed') {
                            if (!isSold) delete liveData[c];
                        } else {
                            if(!isSold) liveData[c] = { status: 'reserved', reservationId: docId, ...d };
                        }
                    });
                });
                updateUI();
                if(auth.currentUser) renderAdminPendingList();
            });

            auth.onAuthStateChanged(u => {
                updateStoreUI(); 
                if(u) {
                    document.getElementById('clientContent').classList.add('hidden');
                    document.getElementById('adminPanel').classList.remove('hidden');
                    document.getElementById('adminLogin').classList.add('hidden');
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    renderAdminPendingList();
                    renderAdminSoldList();
                } else {
                    document.getElementById('clientContent').classList.remove('hidden');
                    document.getElementById('adminPanel').classList.add('hidden');
                }
            });
        }

        // FUNCI√ìN DE ACTUALIZACI√ìN DE LA UI
        function updateUI() {
            let sold = 0;
            for(let i=1; i<=TOTAL_CARDS; i++) {
                if(liveData[i]?.status === 'sold') sold++;
            }
            document.getElementById('availableCount').textContent = TOTAL_CARDS - sold;
            
            const selectionModal = document.getElementById('cardSelectionModal');
            if(selectionModal && selectionModal.style.display === 'flex') {
                renderGrid();
            }

            if(document.getElementById('paymentProcessModal').style.display === 'flex') {
                checkPaymentConflicts();
            }
        }

        function checkPaymentConflicts() {
            let conflicts = [];
            let newSelection = [];
            selectedCards.forEach(card => {
                const status = getStatus(card);
                if (status === 'sold' || status === 'reserved') conflicts.push(card);
                else newSelection.push(card);
            });

            if (conflicts.length > 0) {
                alert(`‚ö†Ô∏è ¬°ATENCI√ìN! El n√∫mero(s) ${conflicts.join(', ')} acaba de ser comprado/reservado por otro jugador. Estos n√∫meros han sido retirados de tu lista.`);
                selectedCards = newSelection;
                saveLocalSelection();

                if (selectedCards.length === 0) {
                    hidePaymentModal(); 
                    localStorage.removeItem('omega_payment_start'); 
                } else {
                    document.getElementById('payCardsList').textContent = selectedCards.join(', ');
                    document.getElementById('payTotal').textContent = `Bs. ${(selectedCards.length * CARD_PRICE).toFixed(2)}`;
                }
            }
        }

        function showCardSelectionModal() {
            document.getElementById('cardPreviewModal').style.display = 'none';
            document.getElementById('paymentProcessModal').style.display = 'none';
            document.getElementById('legalModal').style.display = 'none'; 
            const modal = document.getElementById('cardSelectionModal');
            modal.style.display = 'flex'; 
            renderGrid();
            updateTotal();
            if(selectedCards.length > 0 && localStorage.getItem('omega_payment_start')) {
                startPaymentTimer();
            } else {
                clearInterval(timerInterval);
            }
        }

        function hideCardSelectionModal() {
            document.getElementById('cardSelectionModal').style.display = 'none';
        }

        function getStatus(n) {
            if(liveData[n]?.status === 'sold') return 'sold';
            if(liveData[n]?.status === 'reserved') return 'reserved';
            if(selectedCards.includes(n)) return 'selected'; 
            return 'available';
        }

        function renderGrid() {
            const container = document.getElementById('cardListContainer');
            container.innerHTML = '';
            for(let i=1; i<=TOTAL_CARDS; i++) {
                const st = getStatus(i);
                let tag = 'VER';
                if(st === 'sold') tag = 'VENDIDA';
                if(st === 'reserved') tag = 'OCUPADA'; 
                if(st === 'selected') tag = 'TUYA'; 

                const div = document.createElement('div');
                div.className = `card-item-container status-${st}`;
                
                div.innerHTML = `
                    <div class="bingo-ball" onclick="handleBallClick(${i}, '${st}')">${i}</div>
                    <span class="ver-tag" onclick="event.stopPropagation(); openPreview(${i})">${tag}</span>
                `;
                container.appendChild(div);
            }
        }
        
        function handleBallClick(n, st) {
            if(st === 'sold' || st === 'reserved') {
                openPreview(n);
            } else {
                if(selectedCards.includes(n)) selectedCards = selectedCards.filter(x => x !== n);
                else {
                    if (liveData[n]?.status === 'sold' || liveData[n]?.status === 'reserved') {
                         openPreview(n);
                         return;
                    }
                    selectedCards.push(n);
                }
                saveLocalSelection(); 
                updateTotal();
                renderGrid(); 
            }
        }

        function updateTotal() {
            const tot = selectedCards.length * CARD_PRICE;
            document.getElementById('totalCostDisplay').textContent = `Bs. ${tot.toFixed(2)}`;
        }

        function openPreview(n) {
            previewCard = n;
            const st = getStatus(n);
            const d = liveData[n];
            const btn = document.getElementById('btnPreviewAction');
            const txt = document.getElementById('previewStatusText');
            
            document.getElementById('previewNum').textContent = n;
            document.getElementById('previewImgContainer').innerHTML = `<img src="./tablas/tabla_${n}.png" class="bingo-card-image" onerror="this.src='https://placehold.co/300?text=Tabla+${n}'">`;
            
            if(st === 'sold') {
                txt.textContent = `‚ùå VENDIDA. (${d.name || 'Otro jugador'})`;
                txt.className = "text-red-600 font-bold mb-4";
                btn.style.display = 'none';
            } else if(st === 'reserved') {
                txt.textContent = `‚è≥ OCUPADA. (${d.name || 'Otro jugador'}) Esperando confirmaci√≥n de pago.`;
                txt.className = "text-orange-500 font-bold mb-4";
                btn.style.display = 'none';
            } else {
                const isSel = selectedCards.includes(n);
                txt.textContent = isSel ? "¬øYa no quieres esta tabla?" : "¬øTe gusta esta tabla?";
                txt.className = "text-gray-700 font-bold mb-4";
                btn.style.display = 'block';
                btn.textContent = isSel ? "QUITAR DE MI LISTA" : "AGREGAR A MI LISTA";
                btn.className = isSel ? "flex-1 py-2 bg-red-500 text-white font-bold rounded-lg" : "flex-1 py-2 bg-green-500 text-white font-bold rounded-lg";
                btn.onclick = () => {
                    if(isSel) selectedCards = selectedCards.filter(x => x !== n);
                    else selectedCards.push(n);
                    
                    saveLocalSelection();
                    updateTotal();
                    closePreview();
                    showCardSelectionModal();
                };
            }
            
            document.getElementById('cardSelectionModal').style.display = 'none';
            document.getElementById('cardPreviewModal').style.display = 'flex';
        }

        function closePreview() {
            document.getElementById('cardPreviewModal').style.display = 'none';
            showCardSelectionModal();
        }

        // ================== CLIENTE: PAGO ==================
        function preparePayment() {
            if(selectedCards.length === 0) return alert("Selecciona al menos una tabla");
            
            const cardsToCheck = [...selectedCards];
            let conflictDuringSelection = false;
            for (const card of cardsToCheck) {
                if (liveData[card] && (liveData[card].status === 'sold' || liveData[card].status === 'reserved')) {
                    selectedCards = selectedCards.filter(x => x !== card);
                    conflictDuringSelection = true;
                }
            }
            if (conflictDuringSelection) {
                 saveLocalSelection();
                 updateTotal();
                 alert("‚ö†Ô∏è Una o m√°s de tus tablas fueron reservadas o vendidas mientras seleccionabas. Han sido eliminadas de tu lista.");
            }

            if (selectedCards.length === 0) {
                 hideCardSelectionModal();
                 return; 
            }
            
            document.getElementById('payName').value = '';
            document.getElementById('payPhone').value = '';
            document.getElementById('payRef').value = '';
            document.getElementById('fileNameDisplay').textContent = '';

            if (!localStorage.getItem('omega_payment_start')) {
                localStorage.setItem('omega_payment_start', Date.now());
            }

            hideCardSelectionModal();
            document.getElementById('paymentProcessModal').style.display = 'flex';
            
            document.getElementById('payCardsList').textContent = selectedCards.join(', ');
            document.getElementById('payTotal').textContent = `Bs. ${(selectedCards.length * CARD_PRICE).toFixed(2)}`;
            
            startPaymentTimer();
        }

        function startPaymentTimer() {
            const display = document.getElementById('paymentTimer');
            clearInterval(timerInterval);
            
            const startTime = parseInt(localStorage.getItem('omega_payment_start'));
            if (!startTime) return; 

            timerInterval = setInterval(() => {
                const now = Date.now();
                const elapsedSeconds = Math.floor((now - startTime) / 1000);
                const totalDuration = 300; // 5 minutos
                let remaining = totalDuration - elapsedSeconds;

                if (remaining < 0) remaining = 0;

                const m = Math.floor(remaining / 60);
                const s = remaining % 60;
                display.textContent = `0${m}:${s<10?'0'+s:s}`;

                if(remaining <= 0) {
                    clearInterval(timerInterval);
                    alert("Lo siento, su tiempo de compra se ha agotado. Las tablas han sido liberadas.");
                    
                    localStorage.removeItem('omega_payment_start');
                    selectedCards = []; 
                    localStorage.removeItem('omega_selected_cards');
                    
                    hidePaymentModal();
                    updateUI();
                }
            }, 1000);
        }

        function hidePaymentModal() {
            document.getElementById('paymentProcessModal').style.display = 'none';
            showCardSelectionModal();
        }

        async function submitPayment() {
            const YOUR_CLOUD_NAME = "dcenrp74j"; 
            const YOUR_UPLOAD_PRESET = "bingo_comprobantes"; 
            
            const name = document.getElementById('payName').value;
            const phone = document.getElementById('payPhone').value.replace(/\D/g,'');
            const ref = document.getElementById('payRef').value;
            const file = document.getElementById('payFile').files[0];
            const statusMsg = document.getElementById('uploadStatus');

            if(!name || phone.length < 10 || !ref || !file) {
                statusMsg.textContent = "Datos incompletos o tel√©fono inv√°lido.";
                statusMsg.className = "text-center text-sm mt-2 font-bold text-red-600 block";
                return;
            }

            for (const card of selectedCards) {
                if (liveData[card] && liveData[card].status === 'sold') {
                    statusMsg.textContent = `Error: La tabla N¬∞ ${card} fue VENDIDA. Reinicia tu selecci√≥n.`;
                    statusMsg.className = "text-center text-sm mt-2 font-bold text-red-600 block";
                    return;
                }
            }

            statusMsg.textContent = "Subiendo comprobante... ‚è≥";
            statusMsg.className = "text-center text-sm mt-2 font-bold text-blue-600 block";

            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', YOUR_UPLOAD_PRESET);
                formData.append('public_id', `${phone}_${Date.now()}`); 
                const uploadUrl = `https://api.cloudinary.com/v1_1/${YOUR_CLOUD_NAME}/image/upload`;

                const response = await fetch(uploadUrl, { method: 'POST', body: formData });
                const data = await response.json();
                const url = data.secure_url; 
                
                if (!response.ok || !url) throw new Error(data.error ? data.error.message : response.statusText);

                const newDocRef = await db.collection('reservasPendientes').add({ 
                    name: name,
                    phone: phone,
                    reference: ref,
                    proofURL: url, 
                    cards: selectedCards,
                    totalAmount: selectedCards.length * CARD_PRICE,
                    timestamp: Date.now(),
                    status: 'PENDING_CONFIRMATION'
                });

                selectedCards.forEach(c => {
                    liveData[c] = { status: 'reserved', reservationId: newDocRef.id, name: name, phone: phone };
                });
                
                statusMsg.textContent = "¬°Enviado! üéâ";
                confetti({ particleCount: 100, spread: 70 });
                
                selectedCards = [];
                localStorage.removeItem('omega_selected_cards');
                localStorage.removeItem('omega_payment_start');
                clearInterval(timerInterval);

                setTimeout(() => {
                    hidePaymentModal();
                    alert("Tu pago ha sido enviado. Espera la confirmaci√≥n del administrador. Las tablas han sido reservadas (OCUPADAS).");
                }, 1500);

            } catch(e) {
                console.error("Error al subir:", e);
                statusMsg.textContent = `Error: ${e.message || 'Fallo de red/Cloudinary.'}`;
                statusMsg.className = "text-center text-sm mt-2 font-bold text-red-600 block";
            }
        }

        // ================== CONSULTAS ==================
        async function searchCardByPhone() {
            const p = document.getElementById('searchPhoneInput').value.replace(/\D/g,'');
            if(p.length < 10) return alert("Tel√©fono inv√°lido");
            const div = document.getElementById('searchResultArea');
            const content = document.getElementById('resultContent');
            div.classList.remove('hidden');
            content.innerHTML = 'Buscando...';
            
            let found = [];
            const soldSnap = await db.collection('ventasConfirmadas').where('phone', '==', p).get();
            soldSnap.forEach(doc => { doc.data().cards.forEach(c => found.push({n:c, st:'VENDIDA', col:'green'})); });
            const pendSnap = await db.collection('reservasPendientes').where('phone', '==', p).get();
            pendSnap.forEach(doc => { doc.data().cards.forEach(c => found.push({n:c, st:'EN REVISI√ìN', col:'orange'})); });

            content.innerHTML = '';
            if(found.length === 0) content.innerHTML = '<p>No se encontraron tablas asociadas a este tel√©fono.</p>';
            else {
                document.getElementById('resultTitle').textContent = `Jugador: ${p}`;
                const uniqueCards = [...new Set(found.map(f => f.n))].map(n => {
                    const status = found.filter(f => f.n === n).map(f => f.st).includes('VENDIDA') ? 'VENDIDA' : 'EN REVISI√ìN';
                    const col = status === 'VENDIDA' ? 'green' : 'orange';
                    return { n, st: status, col };
                });

                uniqueCards.forEach(f => {
                    content.innerHTML += `<div class="bg-${f.col}-100 border border-${f.col}-500 p-2 rounded"><span class="text-2xl font-black text-${f.col}-700">${f.n}</span><br><span class="text-xs font-bold text-${f.col}-800">${f.st}</span></div>`;
                });
            }
        }


        function searchCard() {
            const n = parseInt(document.getElementById('cardNumberInput').value);
            if(!n) return;
            const div = document.getElementById('searchResultArea');
            const content = document.getElementById('resultContent');
            div.classList.remove('hidden');
            const d = liveData[n];
            const st = d ? (d.status === 'sold' ? 'VENDIDA' : 'RESERVADA') : 'DISPONIBLE';
            const col = d ? (d.status === 'sold' ? 'green' : 'orange') : 'purple';
            document.getElementById('resultTitle').textContent = `Tabla #${n}`;
            content.innerHTML = `<div class="text-center"><img src="./tablas/tabla_${n}.png" class="bingo-card-image w-48 mx-auto mb-2" onerror="this.src='https://placehold.co/200?text=${n}'"><p class="font-bold text-${col}-600 text-xl">${st}</p>${d && d.name ? `<p class="text-sm text-gray-600">Jugador: ${d.name}</p>` : ''}<a href="./tablas/tabla_${n}.png" download class="inline-block mt-2 bg-purple-600 text-white px-4 py-1 rounded">Descargar</a></div>`;
        }

        function copyToClipboard(txt) { navigator.clipboard.clipboard.writeText(txt); alert("Copiado!"); }

        // ================== ADMIN ACCESO Y RENDER ==================
        document.getElementById('footer-logo').addEventListener('click', () => {
            adminClicks++;
            if(adminClicks >= 6) {
                document.getElementById('clientContent').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                if(auth.currentUser) {
                    document.getElementById('adminLogin').classList.add('hidden');
                    document.getElementById('adminDashboard').classList.remove('hidden');
                }
                adminClicks = 0;
            }
        });

        function adminLogin() {
            const e = document.getElementById('adminEmail').value;
            const p = document.getElementById('adminPassword').value;
            auth.signInWithEmailAndPassword(e, p).then(() => {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                renderAdminPendingList(); renderAdminSoldList();
            }).catch(err => document.getElementById('adminLoginError').textContent = err.message);
        }

        function adminLogout() { auth.signOut().then(() => location.reload()); }

        function renderAdminPendingList() {
            db.collection('reservasPendientes').where('status', '==', 'PENDING_CONFIRMATION').onSnapshot(snap => {
                const div = document.getElementById('pendingCardsList');
                div.innerHTML = '';
                document.getElementById('pendingCount').textContent = snap.size;
                snap.forEach(doc => {
                    const d = doc.data();
                    div.innerHTML += `<div class="bg-white p-4 rounded-lg shadow border-l-4 border-yellow-400"><div class="flex justify-between mb-2"><span class="font-bold text-gray-800">${d.name}</span><span class="text-sm bg-gray-200 px-2 rounded">${d.phone}</span></div><p class="text-sm text-gray-600 mb-1">Ref: <b>${d.reference}</b> | Bs. ${d.totalAmount}</p><p class="text-sm mb-2">Tablas: <b class="text-purple-600">${d.cards.join(', ')}</b></p><a href="${d.proofURL}" target="_blank" class="block text-center bg-blue-50 text-blue-600 py-1 rounded text-sm font-bold mb-3 border border-blue-200">Ver Comprobante</a><div class="flex gap-2"><button onclick="confirmSale('${doc.id}')" class="flex-1 bg-green-500 text-white py-2 rounded font-bold hover:bg-green-600">APROBAR</button><button onclick="rejectSale('${doc.id}')" class="flex-1 bg-red-500 text-white py-2 rounded font-bold hover:bg-red-600">RECHAZAR</button></div></div>`;
                });
            });
        }

        function renderAdminSoldList() {
            db.collection('ventasConfirmadas').orderBy('saleDate', 'desc').limit(50).onSnapshot(snap => {
                const tbody = document.getElementById('soldPlayersTableBody');
                tbody.innerHTML = '';
                document.getElementById('soldCount').textContent = snap.size;
                snap.forEach(doc => {
                    const d = doc.data();
                    tbody.innerHTML += `<tr class="border-b hover:bg-gray-50"><td class="p-3 font-bold">${d.name}</td><td class="p-3 text-xs">${d.phone}</td><td class="p-3 text-green-600 font-bold text-xs break-all">${d.cards.join(',')}</td><td class="p-3"><button onclick="deleteSale('${doc.id}')" class="text-red-500 text-xs underline">Eliminar</button></td></tr>`;
                });
            });
        }

        function confirmSale(id) {
            if(!confirm("¬øConfirmar pago y vender tablas? Esto verificar√° la disponibilidad final.")) return;

            db.collection('reservasPendientes').doc(id).get().then(doc => {
                if (!doc.exists) return alert("Error: La reserva ya no existe.");
                const d = doc.data();
                
                let conflict = false;
                let cardsToSell = [];

                d.cards.forEach(cardNum => {
                    const currentStatus = liveData[cardNum]?.status;
                    const currentReservationId = liveData[cardNum]?.reservationId;

                    if (currentStatus === 'sold') {
                        conflict = true;
                    } else if (currentStatus === 'reserved' && currentReservationId !== id) {
                        conflict = true;
                    } else {
                        cardsToSell.push(cardNum);
                    }
                });
                
                if (conflict) {
                    alert(`‚õî ERROR DE INTEGRIDAD: Se detect√≥ que algunas tablas ya est√°n Vendidas o Reservadas por otro. Solo se intentar√°n confirmar las disponibles (${cardsToSell.join(', ')}).`);
                }

                if (cardsToSell.length === 0) {
                     alert("üö´ Ninguna de las tablas de esta reserva est√° disponible para la venta. El registro se eliminar√° de 'Pendientes'.");
                }
                
                const batch = db.batch();
                
                if (cardsToSell.length > 0) {
                    batch.set(db.collection('ventasConfirmadas').doc(), { 
                        name: d.name, 
                        phone: d.phone, 
                        cards: cardsToSell,
                        saleDate: firebase.firestore.FieldValue.serverTimestamp() 
                    });
                }
                
                batch.delete(db.collection('reservasPendientes').doc(id));
                
                batch.commit().then(() => {
                    if (cardsToSell.length > 0) {
                        alert(`Venta confirmada exitosamente. Tablas vendidas: ${cardsToSell.join(', ')}.`);
                    } else {
                        alert("Reserva eliminada. No se pudo vender ninguna tabla por conflicto.");
                    }
                }).catch(e => {
                    console.error("Error al confirmar venta:", e);
                    alert("Hubo un error al confirmar la venta.");
                });
            });
        }

        function rejectSale(id) { 
            if(confirm("¬øRechazar y liberar tablas?")) {
                db.collection('reservasPendientes').doc(id).delete().then(() => {
                    alert("Reserva rechazada y tablas liberadas.");
                }).catch(e => console.error("Error al rechazar:", e));
            }
        }
        
        function deleteSale(id) { 
            if(confirm("¬øEliminar venta? Las tablas quedar√°n libres.")) {
                db.collection('ventasConfirmadas').doc(id).delete().then(() => {
                    alert("Venta eliminada. Las tablas ser√°n marcadas como disponibles.");
                }).catch(e => console.error("Error al eliminar venta:", e));
            }
        }
        
        function downloadSoldList() {
            db.collection('ventasConfirmadas').get().then(snap => {
                let csv = "Nombre,Telefono,Tablas\n";
                snap.forEach(doc => { 
                    const d = doc.data(); 
                    csv += `${d.name || ''},${d.phone || ''},"${(d.cards || []).join(';')}"\n`; 
                });
                const blob = new Blob([csv],{type:'text/csv'});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'ventas_omega.csv';
                a.click();
            });
        }

        function startBingoTimer() {
            const countdownDisplay = document.getElementById('countdownTimer');

            const timerFunction = () => {
                const now = new Date().getTime();
                const dist = BINGO_DATE - now;

                if (dist < 0) {
                    countdownDisplay.textContent = "¬°JUEGO EN VIVO! üéâ";
                    return;
                }

                const oneSecond = 1000;
                const oneMinute = oneSecond * 60;
                const oneHour = oneMinute * 60;
                const oneDay = oneHour * 24;

                const days = Math.floor(dist / oneDay);
                const hours = Math.floor((dist % oneDay) / oneHour);
                const minutes = Math.floor((dist % oneHour) / oneMinute);
                const seconds = Math.floor((dist % oneMinute) / oneSecond);

                const dDisplay = days > 0 ? `${days}D ` : '';
                const hDisplay = String(hours).padStart(2, '0');
                const mDisplay = String(minutes).padStart(2, '0');
                const sDisplay = String(seconds).padStart(2, '0');

                countdownDisplay.textContent = `${dDisplay}${hDisplay}:${mDisplay}:${sDisplay}`;
            };

            timerFunction();
            setInterval(timerFunction, 1000);
        }

        // ==========================================================
        // ============== FUNCIONES LEGALES ==============
        // ==========================================================

        const legalContent = {
            // COMENTARIO: Aseg√∫rate de reemplazar "[Nombre de tu P√°gina de Bingo]" y "[Fecha Actual]"
            terms: `
                <h2 class="text-xl font-bold text-gray-900 mb-3">T√©rminos y Condiciones del Servicio OMEGA Bingo</h2>
                <p class="text-xs text-gray-500 mb-4">√öltima actualizaci√≥n: 04/12/25</p>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">1. Aceptaci√≥n de los T√©rminos</h3>
                <p>Al acceder y utilizar los servicios de OMEGA Bingo, usted acepta estar sujeto a estos T√©rminos y Condiciones, as√≠ como a nuestra Pol√≠tica de Privacidad.</p>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">2. Uso de la Cuenta y Seguridad</h3>
                <p>Usted es responsable de mantener la confidencialidad de su contrase√±a y de todas las actividades que ocurran bajo su cuenta. Se compromete a notificarnos inmediatamente sobre cualquier uso no autorizado de su cuenta.</p>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">3. Jurisdicci√≥n y Uso Legal (Venezuela / EEUU)</h3>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li><strong>Juegos de Azar:</strong> Al participar, usted declara que cumple con la mayor√≠a de edad legal para participar en juegos de azar en su jurisdicci√≥n. Es su responsabilidad asegurarse de que la participaci√≥n en bingos en l√≠nea es legal en su lugar de residencia, tanto en Venezuela como en Estados Unidos, o cualquier otra ubicaci√≥n.</li>
                    <li><strong>Riesgo:</strong> La participaci√≥n es bajo su propio riesgo. OMEGA Bingo no se hace responsable por cualquier p√©rdida incurrida.</li>
                </ul>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">4. Verificaci√≥n y Documentaci√≥n del Cliente</h3>
                <p>Para garantizar la integridad del juego y la seguridad de las transacciones, podemos solicitar documentaci√≥n adicional (como comprobantes de pago o identificaci√≥n) para verificar su identidad y sus reservas. Esta informaci√≥n ser√° tratada de acuerdo con nuestra Pol√≠tica de Privacidad.</p>

                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">5. Uso del C√≥digo y Licencia</h3>
                <p>El c√≥digo fuente y los elementos de dise√±o (im√°genes, logos, etc.) de esta plataforma son propiedad privada de OMEGA Bingo Masson¬© o sus licenciatarios. El acceso a este sistema est√° estrictamente limitado al uso como cliente para la compra de tablas. Queda terminantemente prohibida la copia, reproducci√≥n, distribuci√≥n, ingenier√≠a inversa o cualquier uso no autorizado del c√≥digo privado de la p√°gina web sin el consentimiento expreso y por escrito de los propietarios de OMEGA Bingo.</p>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">6. Limitaci√≥n de Responsabilidad</h3>
                <p>OMEGA Bingo no se hace responsable de las p√©rdidas o da√±os que surjan de la falta de medidas de seguridad adecuadas en los dispositivos del usuario, o de fallos t√©cnicos fuera de nuestro control razonable, incluyendo interrupciones en el servicio de Internet, fallos de red o errores de pago m√≥vil de terceros.</p>
                `,
            privacy: `
                <h2 class="text-xl font-bold text-gray-900 mb-3">Pol√≠tica de Privacidad de OMEGA Bingo</h2>
                <p class="text-xs text-gray-500 mb-4">√öltima actualizaci√≥n: 4/12/25</p>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">1. Informaci√≥n que Recopilamos</h3>
                <p>Recopilamos informaci√≥n que usted nos proporciona directamente al registrarse, reservar n√∫meros y realizar pagos. Esto puede incluir su nombre, direcci√≥n de correo electr√≥nico, n√∫mero de tel√©fono, detalles de pago y los documentos de verificaci√≥n (como comprobantes de pago) que nos env√≠e.</p>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">2. Uso de la Informaci√≥n y Cumplimiento Legal</h3>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li>Procesar sus reservas y pagos.</li>
                    <li>Verificar su identidad y elegibilidad para jugar.</li>
                    <li>Comunicarnos con usted sobre el estado de su cuenta y premios.</li>
                    <li>Cumplir con nuestras obligaciones legales y reglamentarias, especialmente las relacionadas con la prevenci√≥n de fraude y el juego responsable, en las jurisdicciones aplicables (incluyendo Venezuela y EEUU).</li>
                </ul>

                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">3. Almacenamiento y Seguridad de los Datos (Clave de Confianza)</h3>
                <p>La seguridad de su informaci√≥n personal es nuestra prioridad. Implementamos medidas de seguridad t√©cnicas y organizativas robustas para proteger los datos contra el acceso no autorizado, la alteraci√≥n, la divulgaci√≥n o la destrucci√≥n.</p>
                <ul class="list-disc list-inside space-y-1 ml-4">
                    <li><strong>Alojamiento Seguro:</strong> Todos los datos y documentos de verificaci√≥n (comprobantes de pago) se almacenan en servidores seguros operados por proveedores de servicios certificados que cumplen con est√°ndares de seguridad reconocidos internacionalmente ISO 27001., que manejan la informaci√≥n de acuerdo a est√°ndares globales.</li>
                    <li><strong>Cifrado:</strong> Utilizamos el cifrado de datos (SSL/TLS) para proteger la transmisi√≥n de datos entre su navegador y nuestros servidores. Los datos almacenados tambi√©n est√°n sujetos a medidas de cifrado en reposo cuando es posible.</li>
                    <li><strong>Acceso Restringido:</strong> El acceso a la informaci√≥n personal identificable est√° estrictamente limitado al personal autorizado de OMEGA Bingo que requiere acceso para realizar sus funciones laborales.</li>
                    <li><strong>Gesti√≥n de Documentos:</strong> Los comprobantes de clientes se almacenan en un sistema de gesti√≥n de documentos seguro e interno (Cloudinary privado) y nunca en servicios de alojamiento de archivos p√∫blicos o gen√©ricos como MediaFire, Google Drive personal o Dropbox personal.</li>
                </ul>
                
                <h3 class="font-bold text-lg text-purple-700 mt-4 mb-2">4. Retenci√≥n de Datos</h3>
                <p>Retenemos su informaci√≥n personal solo durante el tiempo necesario para cumplir con los fines para los que fue recopilada, incluyendo cualquier per√≠odo de retenci√≥n legal o reglamentario requerido por las autoridades de licencias de juego y fiscales.</p>
                `
        };

        function showLegalModal(type) {
            const modal = document.getElementById('legalModal');
            const title = document.getElementById('legalModalTitle');
            const body = document.getElementById('legalModalBody');

            if (type === 'terms') {
                title.textContent = 'T√©rminos y Condiciones';
                body.innerHTML = legalContent.terms;
            } else if (type === 'privacy') {
                title.textContent = 'Pol√≠tica de Privacidad';
                body.innerHTML = legalContent.privacy;
            } else {
                return;
            }
            
            modal.style.display = 'flex';
        }

        function hideLegalModal() {
            document.getElementById('legalModal').style.display = 'none';
        }
    
  </script>
</body>
</html>
